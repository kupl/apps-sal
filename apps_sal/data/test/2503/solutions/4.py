from subprocess import *
call(('julia', '-e', '\nconst lines=readlines()\ninput()=shift!(lines)\nint(s)=parse(Int32,s)\nintLine()=map(int,split(input()))\nfunction nextLine(k)\n    x,y,c=split(input())\n    int(x)%2k+1,(int(y)+(c=="W")k)%2k+1\nend\nfunction solve(k,g)\n    m=0\n    for i=1:2k,j=1:2k\n        a=0\n        for x=-1:2,y=-1:2\n            (x+y)%2!=0&&continue\n            v,w=i+x*k,j+y*k\n            v>0<w&&(a+=g[min(2k,v)][min(2k,w)])\n            v>k&&w>0&&(a-=g[min(2k,v-k)][min(2k,w)])\n            w>k&&v>0&&(a-=g[min(2k,v)][min(2k,w-k)])\n            v>k<w&&(a+=g[min(2k,v-k)][min(2k,w-k)])\n        end\n        m=max(m,a)\n    end\n    m\nend\nfunction main()\n    n,k=intLine()\n    g=Array{Int32,1}[[0for j=1:2k]for i=1:2k]\n    for i=1:n\n        x,y=nextLine(k)\n        g[x][y]+=1\n    end\n    println(solve(k,cumsum(map(cumsum,g))))\nend\nmain()\n'))
