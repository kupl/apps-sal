["n, q, k = map(int, input().split())\narr = list(map(int, input().split()))\nquery = list(input())\nq_ = len(query)\nc1 = query.count('?')\nc = arr.count(0)\nif c == n:\n for i in range(c1):\n  print(0)\nelse:\n for i in range(q_):\n  if (i!=0) and (query[i] == '?' and query[i-1] == '?'):\n   print(max_c)\n  elif query[i] == '?':\n   max_c = cnt = 0\n   for j in range(n):\n    if (j != n - 1) and (arr[j] == 1 and arr[j + 1] == 1):\n     cnt += 1\n    else:\n     max_c = max(max_c, cnt + 1)\n     cnt = 0\n    if k < max_c:\n     max_c = k\n     break\n   print(max_c)\n  elif query[i] == '!':\n   temp = arr[n - 1]\n   del arr[n - 1]\n   arr.insert(0, temp)", "n,q,k = map(int, input().split())\na = [int(x) for x in input().split()]\ns = input()\nm = 0\nl = 0\nfor i in a:\n if i==1:\n  m += 1\n else:\n  m = 0\n if m>=k:\n  l = k\n  break\n elif m>l:\n  l = m\nfor i in s:\n if i == '?':\n  print(l)\n else:\n  a.insert(0,a[n-1])\n  a.pop()\n  if a[0]!=0:\n   m = 0\n   l = 0\n   for j in a:\n    if j==1:\n     m += 1\n    else:\n     m = 0\n    if m>=k:\n     l = k\n     break\n    elif m>l:\n     l = m", "# cook your dish here\nimport collections\nn , q , k = map(int,input().split())\na = list(map(int,input().split()))\nst = str(input())\nde = collections.deque(a)\nfor f in range(q):\n if st[f]=='!':\n  de.rotate(1)\n else:\n  mi = 0\n  prev = 0\n  cnt = 0\n  while 1:\n   i = prev\n   if de[i]==1:\n    while de[i]==1:\n     cnt+=1\n     i+=1\n     if i>n-1:\n      break\n   else:\n    i+=1\n   prev = i\n   if cnt>mi:\n    mi=cnt\n   if prev>=n-1:\n    break\n   cnt = 0\n  if mi<k:\n   print(mi)\n  else:\n   print(k)", "n,q,k = map(int,input().split())\nl = list(map(str,input().split()))\ns = input()\nfor x in s:\n if x==\"!\":\n  temp = l[-1]\n  l[1:] = l[:-1]\n  l[0] = temp\n  continue\n elif x==\"?\":\n  s_new = \"\".join(l[:])\n  l_new = s_new.split(\"0\")\n  l_new.sort()\n  if len(l_new[-1])>=k:\n   print(k)\n  else:\n   print(len(l_new[-1]))"]