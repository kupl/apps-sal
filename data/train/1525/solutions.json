["import sys\nt = int(sys.stdin.readline())\n\ndef identify(x, y):\n    rows[x][y] = '2'\n\n    r = 0\n    if x == 0:\n        r |= 1\n    elif rows[x-1][y] == '1':\n        r |= identify(x-1, y)\n    if x == 7:\n        r |= 4\n    elif rows[x+1][y] == '1':\n        r |= identify(x+1, y)\n    if y == 0:\n        r |= 2\n    elif rows[x][y-1] == '1':\n        r |= identify(x, y-1)\n    if y == 7:\n        r |= 8\n    elif rows[x][y+1] == '1':\n        r |= identify(x, y+1)\n    return r\n\nP = 21945\n\nwhile t:\n    t-=1\n    n = int(sys.stdin.readline())-3\n\n    rows = [list(sys.stdin.readline().strip()) for i in range(8)]\n    total = 0\n    for i in range(8):\n        for j in range(8):\n            if rows[i][j] == '1':\n                r = identify(i,j)\n                # print '\\n'.join([''.join(ro) for ro in rows])\n                # print r\n                if n == 0:\n                    total += 1\n                    # print total\n                    continue\n                if r == 0:\n                    total += pow(2, 2*n, P)\n                elif r == 1 or r == 2 or r == 4 or r == 8:\n                    total += pow(2, 2*n-1, P)\n                    if r == 1 or r == 2:\n                        total += pow(2, n, P)\n                elif r == 5 or r == 10:\n                    total += pow(2, n, P)\n                elif r == 3 or r == 6 or r == 12 or r == 9:\n                    total += pow(2, 2*n-2, P)\n                    if r == 3:\n                        total += 3 + 2*pow(2, n-1, P) - 2\n                    elif r == 6 or r == 9:\n                        total += pow(2, n-1, P)\n                elif r == 15:\n                    total += 1\n                else:\n                    total += pow(2, n-1, P)\n                    if r == 11 or r == 7:\n                        total += 1\n                # print total\n    print(total % P)\n"]