["# cook your dish here\n# cook your dish here\nMOD = 10 ** 9 + 7\n \nfor t in range(int(input())):\n    N, M, K = map(int, input().split())\n    A = list(map(int, input().split()))\n    I, D = [0] * (N + 2), [0] * (N + 2)\n    for i in range(M):\n        x, L, R = input().split()\n        L, R = int(L), int(R)\n        if x == 'I':\n            I[L] += 1\n            I[R] -= 1\n        else:\n            D[L] += 1\n            D[R] -= 1\n    \n    impossibru = mx = mn = 0\n    ans = 1\n    for i in range(N):\n        I[i] += I[i - 1]\n        D[i] += D[i - 1]\n        if I[i] and D[i]:\n            impossibru = 1\n            break\n        if not I[i] and not D[i]:\n            ans = ans * (mx - mn + 1) % MOD\n            mn, mx = 1, K\n        elif I[i]:\n            mx = min(mx + 1, K)\n            mn += 1\n        elif D[i]:\n            mn = max(1, mn - 1)\n            mx -= 1\n        if mn > mx:\n            impossibru = 1\n            break\n        if A[i] != -1:\n            if not mn <= A[i] <= mx:\n                impossibru = 1\n                break\n            mn = mx = A[i]\n    ans = ans * (mx - mn + 1) % MOD\n    \n    print(0 if impossibru else ans) ", "MOD = 10 ** 9 + 7\nfor t in range(int(input())):\n    N, M, K = map(int, input().split());    A = list(map(int, input().split()));    I, D = [0] * (N + 2), [0] * (N + 2)\n    for i in range(M):\n        x, L, R = input().split();        L, R = int(L), int(R)\n        if x == 'I':I[L] += 1;I[R] -= 1\n        else:D[L] += 1;D[R] -= 1    \n    impossibru = mx = mn = 0;ans = 1\n    for i in range(N):\n        I[i] += I[i - 1];D[i] += D[i - 1]\n        if I[i] and D[i]:impossibru = 1;break\n        if not I[i] and not D[i]:ans = ans * (mx - mn + 1) % MOD;mn, mx = 1, K\n        elif I[i]:mx = min(mx + 1, K);mn += 1\n        elif D[i]:mn = max(1, mn - 1);mx -= 1\n        if mn > mx:impossibru = 1;break\n        if A[i] != -1:\n            if not mn <= A[i] <= mx:impossibru = 1;break\n            mn = mx = A[i]\n    ans = ans * (mx - mn + 1) % MOD    \n    print(0 if impossibru else ans) ", "# cook your dish here\nMOD = 10 ** 9 + 7\n \nfor t in range(int(input())):\n    N, M, K = map(int, input().split())\n    A = list(map(int, input().split()))\n    I, D = [0] * (N + 2), [0] * (N + 2)\n    for i in range(M):\n        x, L, R = input().split()\n        L, R = int(L), int(R)\n        if x == 'I':\n            I[L] += 1\n            I[R] -= 1\n        else:\n            D[L] += 1\n            D[R] -= 1\n    \n    impossibru = mx = mn = 0\n    ans = 1\n    for i in range(N):\n        I[i] += I[i - 1]\n        D[i] += D[i - 1]\n        if I[i] and D[i]:\n            impossibru = 1\n            break\n        if not I[i] and not D[i]:\n            ans = ans * (mx - mn + 1) % MOD\n            mn, mx = 1, K\n        elif I[i]:\n            mx = min(mx + 1, K)\n            mn += 1\n        elif D[i]:\n            mn = max(1, mn - 1)\n            mx -= 1\n        if mn > mx:\n            impossibru = 1\n            break\n        if A[i] != -1:\n            if not mn <= A[i] <= mx:\n                impossibru = 1\n                break\n            mn = mx = A[i]\n    ans = ans * (mx - mn + 1) % MOD\n    \n    print(0 if impossibru else ans) "]